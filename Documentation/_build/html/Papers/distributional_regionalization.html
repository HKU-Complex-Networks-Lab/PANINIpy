<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Regionalization with Distributional Data &mdash; PANINIpy: Package of Algorithms for Nonparametric Inference with Networks in Python  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=5a409b2d" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Identifying Network Hubs" href="hub_identification.html" />
    <link rel="prev" title="Clustering Network Populations" href="population_clustering.html" />
<meta name="google-site-verification" content="3l7OZw91tYxNz06CwcXcnLpSpus8NPIqopuAM_wWi3M" />
 

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            PANINIpy: Package of Algorithms for Nonparametric Inference with Networks in Python
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Methods:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="hypergraph_binning.html">Binning Temporal Hypergraphs</a></li>
<li class="toctree-l1"><a class="reference internal" href="population_clustering.html">Clustering Network Populations</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Regionalization with Distributional Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#tutorial">Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mdl-regionalization">MDL Regionalization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#demo">Demo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#example-code">Example Code</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-output">Example Output</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#paper-source">Paper source</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="hub_identification.html">Identifying Network Hubs</a></li>
<li class="toctree-l1"><a class="reference internal" href="community_regionalization.html">Regionalization with Community Detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="mdl_backboning.html">MDL Network Backbones</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Table of Content:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="paper.html">Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="paper.html#statement-of-need">Statement of Need</a></li>
<li class="toctree-l1"><a class="reference internal" href="paper.html#related-software-packages">Related Software Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="paper.html#current-modules">Current Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="paper.html#acknowledgments">Acknowledgments</a></li>
<li class="toctree-l1"><a class="reference internal" href="paper.html#references">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PANINIpy: Package of Algorithms for Nonparametric Inference with Networks in Python</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Regionalization with Distributional Data</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/Papers/distributional_regionalization.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="regionalization-with-distributional-data">
<h1>Regionalization with Distributional Data<a class="headerlink" href="#regionalization-with-distributional-data" title="Link to this heading"></a></h1>
<section id="tutorial">
<h2>Tutorial<a class="headerlink" href="#tutorial" title="Link to this heading"></a></h2>
<p>Code to perform spatial regionalization of distributional data using method derived in “Spatial regionalization as optimal data compression” (Kirkley, 2022, <a class="reference external" href="https://arxiv.org/pdf/2111.01813">https://arxiv.org/pdf/2111.01813</a>).</p>
<p>Inputs adjlist, dists, pops, where:</p>
<ul class="simple">
<li><p><strong>adjlist:</strong> List of lists, representing the adjacency list of integer node indices for each unit.</p></li>
<li><p><strong>dists:</strong> 2D numpy array with normalized probability mass function for each unit, representing the distribution of different categories.</p></li>
<li><p><strong>pops:</strong> Array representing the populations of the units.</p></li>
</ul>
<p>Outputs a regionalization result of the form inverse compression ratio, cluster labels, distributions, where:</p>
<ul class="simple">
<li><p><strong>inverse compression ratio:</strong> The ratio of the description length after clustering to the description length of naive transmission.</p></li>
<li><p><strong>cluster labels:</strong> List of cluster labels for all units, ordered by their index in the input adjlist.</p></li>
<li><p><strong>distributions:</strong> The distributions input to the algorithm.</p></li>
</ul>
<p>Algorithm minimizes the following Minimum Description Length (MDL) clustering objective over spatial partitions <img class="math" src="../_images/math/3b9b1f9bf46189501c23f1138e3711426aeda791.png" alt="\mathcal{P}" style="vertical-align: -1px"/> (Eq. 8 in <a class="reference external" href="https://arxiv.org/pdf/2111.01813">https://arxiv.org/pdf/2111.01813</a>):</p>
<div class="math" id="equation1">
<p><img src="../_images/math/c874c6125a2e130809cf2b92eca094eab717060b.png" alt="\mathcal{L}(\mathcal{D}, \mathcal{P}) &amp;= \log \left(\frac{b(V) - 1}{K - 1}\right) + \log \left(\frac{n(V) - 1}{K - 1}\right) \\
&amp;+ \sum_{k=1}^{K} \log \left(\frac{b(V_k) - 1}{R - 1}\right) + \sum_{k=1}^{K} \log \left(\frac{b(V_k) - 1}{n(V_k) - 1}\right) \\
&amp;+ \sum_{k=1}^{K} \log \Omega(a_k, c_k)."/></p>
</div></section>
<section id="mdl-regionalization">
<h2>MDL Regionalization<a class="headerlink" href="#mdl-regionalization" title="Link to this heading"></a></h2>
<p>This module provides a class and functions for performing MDL (Minimum Description Length) regionalization with distributional data.</p>
<table class="docutils align-default" id="id2">
<caption><span class="caption-text">Functions</span><a class="headerlink" href="#id2" title="Link to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Function</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference external" href="#init">MDL_regionalization.__init__(name)</a></p></td>
<td><p>Initialize the MDL_regionalization class.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="#MDL_regionalization">MDL_regionalization.MDL_regionalization(adjlist, dists, pops)</a></p></td>
<td><p>Perform MDL regionalization.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="#str2int">MDL_regionalization.MDL_regionalization.str2int(l)</a></p></td>
<td><p>Convert a list of strings to a list of integers.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="#logNcK">MDL_regionalization.MDL_regionalization.logNcK(n, K)</a></p></td>
<td><p>Compute the logarithm of the binomial coefficient.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="#logMult">MDL_regionalization.MDL_regionalization.logMult(ns)</a></p></td>
<td><p>Compute the logarithm of the multinomial coefficient.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="#log_num_bin_sizes">MDL_regionalization.MDL_regionalization.log_num_bin_sizes(n, K)</a></p></td>
<td><p>Compute the logarithm of the number of ways to partition integer n into k non-negative integers.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="#log_omega">MDL_regionalization.MDL_regionalization.log_omega(row_sums, col_sums)</a></p></td>
<td><p>Compute the logarithm of the number of non-negative integer matrices with specified row and column sums.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="#cluster_DL">MDL_regionalization.MDL_regionalization.cluster_DL(cluster)</a></p></td>
<td><p>Compute the description length of a cluster of spatial units.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="#global_DL">MDL_regionalization.MDL_regionalization.global_DL(clusters)</a></p></td>
<td><p>Compute the global description length for all clusters of spatial units.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="#random_key">MDL_regionalization.MDL_regionalization.random_key()</a></p></td>
<td><p>Generate a random key for a new cluster.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="#cluster_merge">MDL_regionalization.MDL_regionalization.cluster_merge(key1, key2, update=False)</a></p></td>
<td><p>Merge two clusters and update the description length.</p></td>
</tr>
</tbody>
</table>
<section id="reference">
<h3>Reference<a class="headerlink" href="#reference" title="Link to this heading"></a></h3>
<div id="init" class="function-header">
    <span class="class-name">class</span> <span class="function-name">MDL_regionalization.__init__(name)</span>
    <a href="../Code/distributional_regionalization.html#init" class="source-link">[source]</a>
</div><p><strong>Description</strong>:
Initialize the MDL_regionalization class.</p>
<div id="MDL_regionalization" class="function-header">
    <span class="class-name">function</span> <span class="function-name">MDL_regionalization.MDL_regionalization(adjlist, dists, pops)</span>
    <a href="../Code/distributional_regionalization.html#mdl-regionalization" class="source-link">[source]</a>
</div><p><strong>Description</strong>:
Perform MDL spatial regionalization.</p>
<p><strong>Parameters</strong>:</p>
<div class="parameter-block">
    (adjlist, dists, pops)
</div>

<ul class="parameter-list">
    <li><span class="param-name">adjlist</span>: List of lists, representing adjacency list of integer node indices.</li>
    <li><span class="param-name">dists</span>: 2D numpy array with normalize probability mass function for each unit.</li>
    <li><span class="param-name">pops</span>: Populations of units.</li>
</ul><dl class="simple">
<dt><strong>Returns</strong>:</dt><dd><ul class="simple">
<li><p><strong>float</strong>: Inverse compression ratio of data.</p></li>
<li><p><strong>list</strong>: Cluster labels for all units.</p></li>
<li><p><strong>numpy.ndarray</strong>: Distributions input to algorithm.</p></li>
</ul>
</dd>
</dl>
<div id="str2int" class="function-header">
    <span class="class-name">function</span> <span class="function-name">MDL_regionalization.MDL_regionalization.str2int(l)</span>
    <a href="../Code/distributional_regionalization.html#str2int" class="source-link">[source]</a>
</div><p><strong>Description</strong>:
Convert a list of strings to a list of integers.</p>
<p><strong>Parameters</strong>:</p>
<div class="parameter-block">
    (l)
</div>

<ul class="parameter-list">
    <li><span class="param-name">l</span>: List of strings.</li>
</ul><dl class="simple">
<dt><strong>Returns</strong>:</dt><dd><ul class="simple">
<li><p><strong>list</strong>: List of integers.</p></li>
</ul>
</dd>
</dl>
<div id="logNcK" class="function-header">
    <span class="class-name">function</span> <span class="function-name">MDL_regionalization.MDL_regionalization.logNcK(n, K)</span>
    <a href="../Code/distributional_regionalization.html#lognck" class="source-link">[source]</a>
</div><p><strong>Description</strong>:
Compute the logarithm of the binomial coefficient.</p>
<p><strong>Parameters</strong>:</p>
<div class="parameter-block">
    (n, K)
</div>

<ul class="parameter-list">
    <li><span class="param-name">n</span>: Total number of elements.</li>
    <li><span class="param-name">K</span>: Number of elements to choose.</li>
</ul><dl class="simple">
<dt><strong>Returns</strong>:</dt><dd><ul class="simple">
<li><p><strong>float</strong>: Logarithm of the binomial coefficient.</p></li>
</ul>
</dd>
</dl>
<div id="logMult" class="function-header">
    <span class="class-name">function</span> <span class="function-name">MDL_regionalization.MDL_regionalization.logMult(ns)</span>
    <a href="../Code/distributional_regionalization.html#logmult" class="source-link">[source]</a>
</div><p><strong>Description</strong>:
Compute the logarithm of the multinomial coefficient.</p>
<p><strong>Parameters</strong>:</p>
<div class="parameter-block">
    (ns)
</div>

<ul class="parameter-list">
    <li><span class="param-name">ns</span>: List of counts.</li>
</ul><dl class="simple">
<dt><strong>Returns</strong>:</dt><dd><ul class="simple">
<li><p><strong>float</strong>: Logarithm of the multinomial coefficient.</p></li>
</ul>
</dd>
</dl>
<div id="log_num_bin_sizes" class="function-header">
    <span class="class-name">function</span> <span class="function-name">MDL_regionalization.MDL_regionalization.log_num_bin_sizes(n, K)</span>
    <a href="../Code/distributional_regionalization.html#log-num-bin-sizes" class="source-link">[source]</a>
</div><p><strong>Description</strong>:
Compute the logarithm of the number of bin sizes.</p>
<p><strong>Parameters</strong>:</p>
<div class="parameter-block">
    (n, K)
</div>

<ul class="parameter-list">
    <li><span class="param-name">n</span>: Total number of elements.</li>
    <li><span class="param-name">K</span>: Number of bins.</li>
</ul><dl class="simple">
<dt><strong>Returns</strong>:</dt><dd><ul class="simple">
<li><p><strong>float</strong>: Logarithm of the number of bin sizes.</p></li>
</ul>
</dd>
</dl>
<div id="log_omega" class="function-header">
    <span class="class-name">function</span> <span class="function-name">MDL_regionalization.MDL_regionalization.log_omega(row_sums, col_sums)</span>
    <a href="../Code/distributional_regionalization.html#log-omega" class="source-link">[source]</a>
</div><p><strong>Description</strong>:
Compute the logarithm of the number of non-negative integer matrices with specified row and column sums.</p>
<p><strong>Parameters</strong>:</p>
<div class="parameter-block">
    (row_sums, col_sums)
</div>

<ul class="parameter-list">
    <li><span class="param-name">row_sums</span>: Array of row sums.</li>
    <li><span class="param-name">col_sums</span>: Array of column sums.</li>
</ul><dl class="simple">
<dt><strong>Returns</strong>:</dt><dd><ul class="simple">
<li><p><strong>float</strong>: Logarithm of the number of non-negative integer matrices.</p></li>
</ul>
</dd>
</dl>
<div id="cluster_DL" class="function-header">
    <span class="class-name">function</span> <span class="function-name">MDL_regionalization.MDL_regionalization.cluster_DL(cluster)</span>
    <a href="../Code/distributional_regionalization.html#cluster-dl" class="source-link">[source]</a>
</div><p><strong>Description</strong>:
Compute the description length of a cluster of spatial units.</p>
<p><strong>Parameters</strong>:</p>
<div class="parameter-block">
    (cluster)
</div>

<ul class="parameter-list">
    <li><span class="param-name">cluster</span>: Set of spatial unit indices corresponding to the cluster.</li>
</ul><dl class="simple">
<dt><strong>Returns</strong>:</dt><dd><ul class="simple">
<li><p><strong>float</strong>: Description length of the cluster.</p></li>
</ul>
</dd>
</dl>
<div id="global_DL" class="function-header">
    <span class="class-name">function</span> <span class="function-name">MDL_regionalization.MDL_regionalization.global_DL(clusters)</span>
    <a href="../Code/distributional_regionalization.html#global-dl" class="source-link">[source]</a>
</div><p><strong>Description</strong>:
Compute the global description length for all clusters.</p>
<p><strong>Parameters</strong>:</p>
<div class="parameter-block">
    (clusters)
</div>

<ul class="parameter-list">
    <li><span class="param-name">clusters</span>: List of clusters.</li>
</ul><dl class="simple">
<dt><strong>Returns</strong>:</dt><dd><ul class="simple">
<li><p><strong>float</strong>: Global description length for all clusters.</p></li>
</ul>
</dd>
</dl>
<div id="random_key" class="function-header">
    <span class="class-name">function</span> <span class="function-name">MDL_regionalization.MDL_regionalization.random_key()</span>
    <a href="../Code/distributional_regionalization.html#random-key" class="source-link">[source]</a>
</div><p><strong>Description</strong>:
Generate a random key for a new cluster.</p>
<dl class="simple">
<dt><strong>Returns</strong>:</dt><dd><ul class="simple">
<li><p><strong>str</strong>: Random key for a new cluster.</p></li>
</ul>
</dd>
</dl>
<div id="cluster_merge" class="function-header">
    <span class="class-name">function</span> <span class="function-name">MDL_regionalization.MDL_regionalization.cluster_merge(key1, key2, update=False)</span>
    <a href="../Code/distributional_regionalization.html#cluster-merge" class="source-link">[source]</a>
</div><p><strong>Description</strong>:
Merge two clusters and update the description length.</p>
<p><strong>Parameters</strong>:</p>
<div class="parameter-block">
    (key1, key2, update=False)
</div>

<ul class="parameter-list">
    <li><span class="param-name">key1</span>: Key of the first cluster.</li>
    <li><span class="param-name">key2</span>: Key of the second cluster.</li>
    <li><span class="param-name">update</span>: Boolean indicating whether to update the clusters.</li>
</ul><dl class="simple">
<dt><strong>Returns</strong>:</dt><dd><ul class="simple">
<li><p><strong>tuple</strong>: Tuple containing the minimum change in description length and a boolean indicating if the merge was successful.</p></li>
</ul>
</dd>
</dl>
</section>
</section>
<section id="demo">
<h2>Demo<a class="headerlink" href="#demo" title="Link to this heading"></a></h2>
<section id="example-code">
<h3>Example Code<a class="headerlink" href="#example-code" title="Link to this heading"></a></h3>
<p>Step 1: Import necessary libraries</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">paninipy.distributional_regionalization</span> <span class="kn">import</span> <span class="n">MDL_regionalization</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Point</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">ListedColormap</span>
</pre></div>
</div>
<p>Step 2: Load and prepare the data</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data_dir</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;D:\Research HKU\PYPI_lib\ScholarCodeCollective\distributional_regionalization&quot;</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_dir</span><span class="p">)</span>
<span class="n">nodelist</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s1">&#39;metro_tract_metadata.csv&#39;</span><span class="p">))</span>
<span class="n">edgelist</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s1">&#39;metro_network_edgelists.csv&#39;</span><span class="p">))</span>
<span class="n">nodelist</span> <span class="o">=</span> <span class="n">nodelist</span><span class="p">[</span><span class="n">nodelist</span><span class="p">[</span><span class="s1">&#39;metro&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;New_Haven-Milford--CT&#39;</span><span class="p">]</span>
<span class="n">nodelist</span><span class="p">[</span><span class="s1">&#39;tract_index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">nodelist</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">edgelist</span> <span class="o">=</span> <span class="n">edgelist</span><span class="p">[</span><span class="n">edgelist</span><span class="p">[</span><span class="s1">&#39;tract1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">nodelist</span><span class="p">[</span><span class="s1">&#39;tractID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">edgelist</span><span class="p">[</span><span class="s1">&#39;tract2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">nodelist</span><span class="p">[</span><span class="s1">&#39;tractID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)]</span>
<span class="n">tract2index</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">nodelist</span><span class="p">[</span><span class="s1">&#39;tractID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">nodelist</span><span class="p">[</span><span class="s1">&#39;tract_index&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
<span class="n">edgelist</span><span class="p">[</span><span class="s1">&#39;tract1_index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">tract2index</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">edgelist</span><span class="p">[</span><span class="s1">&#39;tract1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
<span class="n">edgelist</span><span class="p">[</span><span class="s1">&#39;tract2_index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">tract2index</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">edgelist</span><span class="p">[</span><span class="s1">&#39;tract2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>

<span class="n">dists</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">eval</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">nodelist</span><span class="p">[</span><span class="s1">&#39;races2010&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">])</span>
<span class="n">pops</span> <span class="o">=</span> <span class="n">nodelist</span><span class="p">[</span><span class="s1">&#39;pop2010&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="n">adjlist</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nodelist</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">edgelist</span><span class="p">[[</span><span class="s1">&#39;tract1_index&#39;</span><span class="p">,</span> <span class="s1">&#39;tract2_index&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
    <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">e</span>
    <span class="n">adjlist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
    <span class="n">adjlist</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></div>
</div>
<p>Step 3: Run the MDL regionalization algorithm</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mdl_instance</span> <span class="o">=</span> <span class="n">MDL_regionalization</span><span class="p">(</span><span class="s2">&quot;example&quot;</span><span class="p">)</span>
<span class="n">inverse_compression_ratio</span><span class="p">,</span> <span class="n">cluster_labels</span><span class="p">,</span> <span class="n">dists</span> <span class="o">=</span> <span class="n">mdl_instance</span><span class="o">.</span><span class="n">MDL_regionalization</span><span class="p">(</span><span class="n">adjlist</span><span class="p">,</span> <span class="n">dists</span><span class="p">,</span> <span class="n">pops</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">inverse_compression_ratio</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cluster_labels</span><span class="p">)</span>
</pre></div>
</div>
<p>Step 4: Load geometries and map clusters</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">geometry_data_dir</span> <span class="o">=</span> <span class="s1">&#39;D:\Research HKU\mobility\geometry_trct&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loading geometries...&quot;</span><span class="p">)</span>
<span class="n">geometries_us</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">geometry_data_dir</span><span class="p">,</span> <span class="s1">&#39;Tract_2010Census_DP1_ct.shp&#39;</span><span class="p">))</span>
<span class="n">geometries_us</span><span class="p">[</span><span class="s1">&#39;tractID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geometries_us</span><span class="p">[</span><span class="s1">&#39;GEOID10&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

<span class="n">required_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;tractID&#39;</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">required_columns</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">geometries_us</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing required column in geometries_us: </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">nodelist</span><span class="p">[</span><span class="s1">&#39;tractID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodelist</span><span class="p">[</span><span class="s1">&#39;tractID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

<span class="n">cluster_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;tractID&#39;</span><span class="p">:</span> <span class="n">nodelist</span><span class="p">[</span><span class="s1">&#39;tractID&#39;</span><span class="p">],</span>
    <span class="s1">&#39;cluster&#39;</span><span class="p">:</span> <span class="n">cluster_labels</span>
<span class="p">})</span>

<span class="n">gdf_clusters</span> <span class="o">=</span> <span class="n">geometries_us</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">cluster_df</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;tractID&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
<span class="n">cluster_centroids</span> <span class="o">=</span> <span class="n">gdf_clusters</span><span class="o">.</span><span class="n">dissolve</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;cluster&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">centroid</span>
<span class="n">unique_clusters</span> <span class="o">=</span> <span class="n">gdf_clusters</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">unique_clusters</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

<span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">tab20</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
<span class="n">custom_cmap</span> <span class="o">=</span> <span class="n">ListedColormap</span><span class="p">(</span><span class="n">colors</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_clusters</span><span class="p">)])</span>
</pre></div>
</div>
<p>Step 5: Define the visualization function and plot the results</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_combined_visualization</span><span class="p">(</span><span class="n">gdf_clusters</span><span class="p">,</span> <span class="n">cluster_centroids</span><span class="p">,</span> <span class="n">inverse_compression_ratio</span><span class="p">,</span> <span class="n">dists</span><span class="p">,</span> <span class="n">unique_clusters</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">18</span><span class="p">),</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;height_ratios&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]})</span>

    <span class="n">gdf_clusters</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;cluster&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">custom_cmap</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Clustering Results for New Haven-Milford, CT</span><span class="se">\n</span><span class="s1">Inverse Compression Ratio: </span><span class="si">{</span><span class="n">inverse_compression_ratio</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Longitude&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Latitude&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">handles</span> <span class="o">=</span> <span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="n">custom_cmap</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Cluster </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
              <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_clusters</span><span class="p">)]</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">handles</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Clusters&#39;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>

    <span class="n">race_groups</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Non-Hispanic White&#39;</span><span class="p">,</span> <span class="s1">&#39;Non-Hispanic Black&#39;</span><span class="p">,</span> <span class="s1">&#39;Asian&#39;</span><span class="p">,</span> <span class="s1">&#39;Hispanic&#39;</span><span class="p">,</span> <span class="s1">&#39;Other&#39;</span><span class="p">]</span>
    <span class="n">bar_width</span> <span class="o">=</span> <span class="mf">0.1</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cluster_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_clusters</span><span class="p">):</span>
        <span class="n">cluster_data</span> <span class="o">=</span> <span class="n">gdf_clusters</span><span class="p">[</span><span class="n">gdf_clusters</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">cluster_id</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">cluster_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">average_distribution</span> <span class="o">=</span> <span class="n">dists</span><span class="p">[</span><span class="n">cluster_data</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">race_groups</span><span class="p">))</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">bar_width</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">average_distribution</span><span class="p">,</span> <span class="n">bar_width</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">custom_cmap</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Cluster </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">cluster_id</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Race Groups&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Average Distribution&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">race_groups</span><span class="p">))</span> <span class="o">+</span> <span class="n">bar_width</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_clusters</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">race_groups</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Clusters&#39;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Combined Histogram for All Clusters&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;MDL_regionalization_demo.png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plot_combined_visualization</span><span class="p">(</span><span class="n">gdf_clusters</span><span class="p">,</span> <span class="n">cluster_centroids</span><span class="p">,</span> <span class="n">inverse_compression_ratio</span><span class="p">,</span> <span class="n">dists</span><span class="p">,</span> <span class="n">unique_clusters</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="example-output">
<h3>Example Output<a class="headerlink" href="#example-output" title="Link to this heading"></a></h3>
<figure class="align-default">
<img alt="Example output showing the MDL regionalization clustering results for New Haven-Milford, CT." src="../_images/MDL_regionalization_demo.png" />
</figure>
<p>Example output showing the MDL regionalization results for New Haven-Milford, CT using 2010 census data indicating the ethnoracial distribution within each spatial unit’s (census tract’s) population. The top plot shows the spatial distribution of the clusters of spatial units, indicated by different colors. The bottom plot shows the fraction of the population within each cluster falling into the categories [‘Non-Hispanic White’, ‘Non-Hispanic Black’, ‘Asian’, ‘Hispanic’, ‘Other’].</p>
</section>
</section>
<section id="paper-source">
<h2>Paper source<a class="headerlink" href="#paper-source" title="Link to this heading"></a></h2>
<p>If you use this algorithm in your work, please cite:</p>
<p>A. Kirkley, Spatial regionalization based on optimal information compression. Communications Physics 5, 249 (2022).
Paper: <a class="reference external" href="https://arxiv.org/abs/2111.01813">https://arxiv.org/abs/2111.01813</a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="population_clustering.html" class="btn btn-neutral float-left" title="Clustering Network Populations" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="hub_identification.html" class="btn btn-neutral float-right" title="Identifying Network Hubs" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Baiyue.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>